{"version":3,"file":"discover-B306xbjr.js","sources":["../../src/script/views/user/discover.js"],"sourcesContent":["import auth from '../../utils/auth'\r\nimport reset, { cleanupAll } from '../../utils/reset'\r\nimport Navbar from './components/Navbar'\r\nimport supabase from '../../utils/supabaseClients'\r\nimport { trackPageVisit } from '../../utils/analtics'\r\n\r\n\r\nconst discover = async () => {\r\n    const authCheck = await auth.check('discover')\r\n    if (!authCheck) return { html: '', pageEvents: () => { } }\r\n\r\n    reset('Olymp AI | Discover')\r\n    cleanupAll();\r\n    await trackPageVisit()\r\n    const { html: navbar, pageEvents: navEvents } = Navbar()\r\n\r\n    // Get user data and greeting\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('full_name')\r\n        .eq('id', user.id)\r\n        .single()\r\n\r\n    const getGreeting = () => {\r\n        const hour = new Date().getHours()\r\n        return hour < 12 ? 'Good Morning' : hour < 18 ? 'Good Afternoon' : 'Good Evening'\r\n    }\r\n\r\n    const marketWidgets = {\r\n        tickerTape: {\r\n            widget: \"ticker-tape\",\r\n            containerId: \"ticker_tape\",\r\n            config: {\r\n                colorTheme: \"dark\",\r\n                isTransparent: false,\r\n                showSymbolLogo: true,\r\n                displayMode: \"adaptive\",\r\n                locale: \"en\",\r\n                symbols: [\r\n                    { proName: \"BITSTAMP:BTCUSD\", title: \"Bitcoin\" },\r\n                    { proName: \"BITSTAMP:ETHUSD\", title: \"Ethereum\" },\r\n                    { proName: \"FOREXCOM:SPXUSD\", title: \"S&P 500\" },\r\n                    { proName: \"FX_IDC:EURUSD\", title: \"EUR/USD\" },\r\n                    { proName: \"OANDA:XAUUSD\", title: \"Gold\" }\r\n                ]\r\n            }\r\n        },\r\n        marketQuotes: {\r\n            widget: \"market-quotes\",\r\n            containerId: \"market_quotes\",\r\n            config: {\r\n                width: \"100%\",\r\n                height: \"400\",\r\n                locale: \"en\",\r\n                colorTheme: \"dark\",\r\n                isTransparent: false,\r\n                showSymbolLogo: true\r\n            }\r\n        },\r\n        hotlists: {\r\n            widget: \"hotlists\",\r\n            containerId: \"market_hotlists\",\r\n            config: {\r\n                colorTheme: \"dark\",\r\n                isTransparent: false,\r\n                showChart: true,\r\n                locale: \"en\",\r\n                width: \"100%\",\r\n                height: \"400\",\r\n                dateRange: \"12M\"\r\n            }\r\n        },\r\n        forexCross: {\r\n            widget: \"forex-cross-rates\",\r\n            containerId: \"forex_cross_rates\",\r\n            config: {\r\n                width: \"100%\",\r\n                height: \"400\",\r\n                colorTheme: \"dark\",\r\n                isTransparent: false,\r\n                currencies: [\"EUR\", \"USD\", \"JPY\", \"GBP\", \"CHF\", \"AUD\", \"CAD\", \"NZD\"]\r\n            }\r\n        }\r\n    }\r\n\r\n    const initializeWidget = (widget) => {\r\n        return new Promise((resolve) => {\r\n            const container = document.getElementById(widget.containerId)\r\n            if (container) {\r\n                const script = document.createElement('script')\r\n                script.src = `https://s3.tradingview.com/external-embedding/embed-widget-${widget.widget}.js`\r\n                script.type = 'text/javascript'\r\n                script.async = true\r\n                script.innerHTML = JSON.stringify(widget.config)\r\n\r\n                script.onload = () => resolve()\r\n                container.appendChild(script)\r\n            }\r\n        })\r\n    }\r\n\r\n    async function initializeWidgets() {\r\n        try {\r\n            await Promise.all(Object.values(marketWidgets).map(widget => initializeWidget(widget)))\r\n        } catch (error) {\r\n            console.error('Error initializing widgets:', error)\r\n        }\r\n    }\r\n\r\n    async function pageEvents() {\r\n        await navEvents()\r\n        await initializeWidgets()\r\n\r\n        // Add responsive handlers for mobile/desktop switches\r\n        const mediaQuery = window.matchMedia('(min-width: 768px)')\r\n        const handleViewportChange = (e) => {\r\n            const containers = document.querySelectorAll('.widget-container')\r\n            containers.forEach(container => {\r\n                container.style.height = e.matches ? '400px' : '300px'\r\n            })\r\n        }\r\n        mediaQuery.addListener(handleViewportChange)\r\n        handleViewportChange(mediaQuery)\r\n    }\r\n\r\n    return {\r\n        html: /* html */`\r\n            ${navbar}\r\n            <main class=\"main-scroll-view flex-1\">\r\n                <!-- Ticker Tape - Fixed at top -->\r\n                <div class=\"sticky top-0 z-10 h-24 lg:px-6 lg:mx-auto\">\r\n                    <div id=\"${marketWidgets.tickerTape.containerId}\"></div>\r\n                </div>\r\n\r\n                <!-- User Greeting -->\r\n                <div class=\"p-4 pt-20 md:p-6 md:pt-8\">\r\n                    <h1 class=\"text-2xl font-bold text-white\">\r\n                        ${getGreeting()}, ${profile?.full_name?.split(' ')[0] || 'Trader'}!\r\n                    </h1>\r\n                    <p class=\"text-gray-400 mt-1\">Here's your market overview</p>\r\n                </div>\r\n\r\n                <!-- Market Overview Sections -->\r\n                <div class=\"p-4 md:p-6 space-y-6 pb-14 lg:pb-0\">\r\n                    <!-- Market Quotes Section -->\r\n                    <section class=\"widget-container rounded-lg overflow-hidden\">\r\n                        <h2 class=\"text-xl font-semibold text-white mb-4\">Market Overview</h2>\r\n                        <div id=\"${marketWidgets.marketQuotes.containerId}\" class=\"h-full\"></div>\r\n                    </section>\r\n\r\n                    <!-- Two Column Layout -->\r\n                    <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                        <!-- Hotlists -->\r\n                        <section class=\"widget-container rounded-lg overflow-hidden\">\r\n                            <h2 class=\"text-xl font-semibold text-white mb-4\">Top Movers</h2>\r\n                            <div id=\"${marketWidgets.hotlists.containerId}\" class=\"h-full\"></div>\r\n                        </section>\r\n\r\n                        <!-- Forex Cross Rates -->\r\n                        <section class=\"widget-container rounded-lg overflow-hidden\">\r\n                            <h2 class=\"text-xl font-semibold text-white mb-4\">Forex Overview</h2>\r\n                            <div id=\"${marketWidgets.forexCross.containerId}\" class=\"h-full\"></div>\r\n                        </section>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        `,\r\n        pageEvents\r\n    }\r\n}\r\n\r\nexport default discover"],"names":["discover","auth","reset","cleanupAll","trackPageVisit","navbar","navEvents","Navbar","user","supabase","profile","getGreeting","hour","marketWidgets","initializeWidget","widget","resolve","container","script","initializeWidgets","error","pageEvents","mediaQuery","handleViewportChange","e"],"mappings":"gZAOK,MAACA,EAAW,SAAY,CAEzB,GAAI,CADc,MAAMC,EAAK,MAAM,UAAU,EAC7B,MAAO,CAAE,KAAM,GAAI,WAAY,IAAM,CAAE,CAAC,EAExDC,EAAM,qBAAqB,EAC3BC,IACA,MAAMC,EAAc,EACpB,KAAM,CAAE,KAAMC,EAAQ,WAAYC,CAAS,EAAKC,EAAM,EAGhD,CAAE,KAAM,CAAE,KAAAC,CAAI,CAAE,EAAK,MAAMC,EAAS,KAAK,QAAO,EAChD,CAAE,KAAMC,CAAO,EAAK,MAAMD,EAC3B,KAAK,UAAU,EACf,OAAO,WAAW,EAClB,GAAG,KAAMD,EAAK,EAAE,EAChB,OAAM,EAELG,EAAc,IAAM,CACtB,MAAMC,EAAO,IAAI,KAAI,EAAG,SAAQ,EAChC,OAAOA,EAAO,GAAK,eAAiBA,EAAO,GAAK,iBAAmB,cACvE,EAEMC,EAAgB,CAClB,WAAY,CACR,OAAQ,cACR,YAAa,cACb,OAAQ,CACJ,WAAY,OACZ,cAAe,GACf,eAAgB,GAChB,YAAa,WACb,OAAQ,KACR,QAAS,CACL,CAAE,QAAS,kBAAmB,MAAO,SAAS,EAC9C,CAAE,QAAS,kBAAmB,MAAO,UAAU,EAC/C,CAAE,QAAS,kBAAmB,MAAO,SAAS,EAC9C,CAAE,QAAS,gBAAiB,MAAO,SAAS,EAC5C,CAAE,QAAS,eAAgB,MAAO,MAAM,CAC5D,CACA,CACA,EACQ,aAAc,CACV,OAAQ,gBACR,YAAa,gBACb,OAAQ,CACJ,MAAO,OACP,OAAQ,MACR,OAAQ,KACR,WAAY,OACZ,cAAe,GACf,eAAgB,EAChC,CACA,EACQ,SAAU,CACN,OAAQ,WACR,YAAa,kBACb,OAAQ,CACJ,WAAY,OACZ,cAAe,GACf,UAAW,GACX,OAAQ,KACR,MAAO,OACP,OAAQ,MACR,UAAW,KAC3B,CACA,EACQ,WAAY,CACR,OAAQ,oBACR,YAAa,oBACb,OAAQ,CACJ,MAAO,OACP,OAAQ,MACR,WAAY,OACZ,cAAe,GACf,WAAY,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,KAAK,CACnF,CACA,CACA,EAEUC,EAAoBC,GACf,IAAI,QAASC,GAAY,CAC5B,MAAMC,EAAY,SAAS,eAAeF,EAAO,WAAW,EAC5D,GAAIE,EAAW,CACX,MAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,IAAM,8DAA8DH,EAAO,MAAM,MACxFG,EAAO,KAAO,kBACdA,EAAO,MAAQ,GACfA,EAAO,UAAY,KAAK,UAAUH,EAAO,MAAM,EAE/CG,EAAO,OAAS,IAAMF,EAAO,EAC7BC,EAAU,YAAYC,CAAM,CAChC,CACJ,CAAC,EAGL,eAAeC,GAAoB,CAC/B,GAAI,CACA,MAAM,QAAQ,IAAI,OAAO,OAAON,CAAa,EAAE,IAAIE,GAAUD,EAAiBC,CAAM,CAAC,CAAC,CAC1F,OAASK,EAAO,CACZ,QAAQ,MAAM,8BAA+BA,CAAK,CACtD,CACJ,CAEA,eAAeC,GAAa,CACxB,MAAMf,EAAS,EACf,MAAMa,EAAiB,EAGvB,MAAMG,EAAa,OAAO,WAAW,oBAAoB,EACnDC,EAAwBC,GAAM,CACb,SAAS,iBAAiB,mBAAmB,EACrD,QAAQP,GAAa,CAC5BA,EAAU,MAAM,OAASO,EAAE,QAAU,QAAU,OACnD,CAAC,CACL,EACAF,EAAW,YAAYC,CAAoB,EAC3CA,EAAqBD,CAAU,CACnC,CAEA,MAAO,CACH,KAAgB;AAAA,cACVjB,CAAM;AAAA;AAAA;AAAA;AAAA,+BAIWQ,EAAc,WAAW,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAMzCF,EAAW,CAAE,KAAKD,GAAS,WAAW,MAAM,GAAG,EAAE,CAAC,GAAK,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAUtDG,EAAc,aAAa,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAQlCA,EAAc,SAAS,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAMlCA,EAAc,WAAW,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,UAMnE,WAAAQ,CACR,CACA"}