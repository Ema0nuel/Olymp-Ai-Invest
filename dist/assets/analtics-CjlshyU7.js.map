{"version":3,"file":"analtics-CjlshyU7.js","sources":["../../src/script/utils/analtics.js"],"sourcesContent":["import supabase from './supabaseClients';\r\n\r\nlet pageLogged = false; // Prevent double logging\r\n\r\nexport async function trackPageVisit(extra = {}) {\r\n    if (pageLogged) return;\r\n    pageLogged = true;\r\n\r\n    try {\r\n        // Get User Info\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n\r\n        // Get IP + Geolocation\r\n        let geoData = {};\r\n        try {\r\n            const geoRes = await fetch('https://ipapi.co/json/');\r\n            geoData = await geoRes.json();\r\n        } catch (error) {\r\n            console.error('Geo fetch error:', error);\r\n        }\r\n\r\n        // Prepare data\r\n        const logData = {\r\n            table_name: 'page_visit',\r\n            operation: 'VIEW',\r\n            row_data: {\r\n                page: window.location.pathname,\r\n                title: document.title,\r\n                referrer: document.referrer || null,\r\n                ...extra\r\n            },\r\n            ip_address: geoData.ip || null,\r\n            geo: {\r\n                city: geoData.city,\r\n                region: geoData.region,\r\n                country: geoData.country_name,\r\n                latitude: geoData.latitude,\r\n                longitude: geoData.longitude,\r\n                timezone: geoData.timezone\r\n            },\r\n            device_info: {\r\n                user_agent: navigator.userAgent,\r\n                platform: navigator.platform,\r\n                language: navigator.language,\r\n                screen: {\r\n                    width: window.screen.width,\r\n                    height: window.screen.height\r\n                }\r\n            },\r\n            user_id: user?.id || null\r\n        };\r\n\r\n        // Log to Supabase\r\n        const { error } = await supabase\r\n            .from('activity_logs')\r\n            .insert([logData]);\r\n\r\n        if (error) throw error;\r\n\r\n    } catch (err) {\r\n        console.error('Analytics tracking error:', err);\r\n    }\r\n}"],"names":["pageLogged","trackPageVisit","extra","user","supabase","geoData","error","logData","err"],"mappings":"kDAEA,IAAIA,EAAa,GAEV,eAAeC,EAAeC,EAAQ,GAAI,CAC7C,GAAI,CAAAF,EACJ,CAAAA,EAAa,GAEb,GAAI,CAEA,KAAM,CAAE,KAAM,CAAE,KAAAG,CAAI,CAAE,EAAK,MAAMC,EAAS,KAAK,UAG/C,IAAIC,EAAU,CAAA,EACd,GAAI,CAEAA,EAAU,MADK,MAAM,MAAM,wBAAwB,GAC5B,MAC3B,OAASC,EAAO,CACZ,QAAQ,MAAM,mBAAoBA,CAAK,CAC3C,CAGA,MAAMC,EAAU,CACZ,WAAY,aACZ,UAAW,OACX,SAAU,CACN,KAAM,OAAO,SAAS,SACtB,MAAO,SAAS,MAChB,SAAU,SAAS,UAAY,KAC/B,GAAGL,CACnB,EACY,WAAYG,EAAQ,IAAM,KAC1B,IAAK,CACD,KAAMA,EAAQ,KACd,OAAQA,EAAQ,OAChB,QAASA,EAAQ,aACjB,SAAUA,EAAQ,SAClB,UAAWA,EAAQ,UACnB,SAAUA,EAAQ,QAClC,EACY,YAAa,CACT,WAAY,UAAU,UACtB,SAAU,UAAU,SACpB,SAAU,UAAU,SACpB,OAAQ,CACJ,MAAO,OAAO,OAAO,MACrB,OAAQ,OAAO,OAAO,MAC1C,CACA,EACY,QAASF,GAAM,IAAM,IACjC,EAGc,CAAE,MAAAG,CAAK,EAAK,MAAMF,EACnB,KAAK,eAAe,EACpB,OAAO,CAACG,CAAO,CAAC,EAErB,GAAID,EAAO,MAAMA,CAErB,OAASE,EAAK,CACV,QAAQ,MAAM,4BAA6BA,CAAG,CAClD,EACJ"}